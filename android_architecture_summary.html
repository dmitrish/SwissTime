<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android ActivityThread & System Architecture Summary</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fafafa;
            color: #333;
        }
        
        h1 {
            color: #1976d2;
            border-bottom: 3px solid #1976d2;
            padding-bottom: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        h2 {
            color: #424242;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        h3 {
            color: #666;
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .objective {
            background-color: #e3f2fd;
            border-left: 4px solid #1976d2;
            padding: 15px;
            margin-bottom: 25px;
            font-style: italic;
        }
        
        code {
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #d32f2f;
        }
        
        pre {
            border-radius: 5px;
            margin: 15px 0;
        }
        
        pre code {
            background: none;
            padding: 0;
            color: inherit;
            font-size: 0.85em;
            line-height: 1.4;
        }
        
        .important {
            background-color: #fff3e0;
            border-left: 4px solid #f57c00;
            padding: 10px 15px;
            margin: 15px 0;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .architecture-diagram {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .svg-container {
            text-align: center;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .component-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .component-card.system {
            border-color: #f44336;
            background: linear-gradient(135deg, #fff 0%, #ffebee 100%);
        }
        
        .component-card.app {
            border-color: #4caf50;
            background: linear-gradient(135deg, #fff 0%, #e8f5e8 100%);
        }
        
        .component-card.userspace {
            border-color: #2196f3;
            background: linear-gradient(135deg, #fff 0%, #e3f2fd 100%);
        }
        
        .component-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .system .component-title { color: #d32f2f; }
        .app .component-title { color: #388e3c; }
        .userspace .component-title { color: #1976d2; }
        
        .flow-step {
            background: #f8f9fa;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        .step-number {
            display: inline-block;
            background: #2196f3;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            text-align: center;
            line-height: 25px;
            font-weight: bold;
            margin-right: 10px;
            font-size: 0.9em;
        }
        
        ul {
            padding-left: 20px;
        }
        
        li {
            margin-bottom: 6px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f5f5f5;
            font-weight: bold;
            color: #333;
        }
        
        .highlight-box {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
        }
        
        @media (max-width: 768px) {
            .component-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>Android ActivityThread & System Architecture Summary</h1>
    
    <div class="objective">
        <strong>Summary:</strong> A comprehensive overview of Android's application architecture, focusing on the relationship between ActivityManagerService (AMS), ActivityThread, and your application components, plus the role of hardware drivers in the Android stack.
    </div>

    <div class="section">
        <h2>Android System Architecture Overview</h2>
        
        <div class="svg-container">
            <svg width="800" height="500" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
                <!-- Background layers -->
                <rect x="0" y="0" width="800" height="120" fill="#ffebee" stroke="#f44336" stroke-width="2"/>
                <text x="20" y="30" font-family="Arial" font-size="18" font-weight="bold" fill="#d32f2f">System Server Process</text>
                
                <rect x="0" y="140" width="800" height="120" fill="#e8f5e8" stroke="#4caf50" stroke-width="2"/>
                <text x="20" y="170" font-family="Arial" font-size="18" font-weight="bold" fill="#388e3c">Application Process (Your App)</text>
                
                <rect x="0" y="280" width="800" height="100" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
                <text x="20" y="310" font-family="Arial" font-size="18" font-weight="bold" fill="#1976d2">Hardware Abstraction Layer (HAL)</text>
                
                <rect x="0" y="400" width="800" height="80" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"/>
                <text x="20" y="430" font-family="Arial" font-size="18" font-weight="bold" fill="#7b1fa2">Linux Kernel</text>
                
                <!-- Components -->
                <rect x="50" y="40" width="200" height="60" fill="white" stroke="#f44336" stroke-width="2" rx="5"/>
                <text x="150" y="60" font-family="Arial" font-size="14" font-weight="bold" fill="#d32f2f" text-anchor="middle">ActivityManagerService</text>
                <text x="150" y="78" font-family="Arial" font-size="12" fill="#666" text-anchor="middle">Global Coordinator</text>
                
                <rect x="300" y="40" width="180" height="60" fill="white" stroke="#f44336" stroke-width="2" rx="5"/>
                <text x="390" y="60" font-family="Arial" font-size="14" font-weight="bold" fill="#d32f2f" text-anchor="middle">WindowManagerService</text>
                <text x="390" y="78" font-family="Arial" font-size="12" fill="#666" text-anchor="middle">UI Management</text>
                
                <rect x="50" y="180" width="150" height="60" fill="white" stroke="#4caf50" stroke-width="2" rx="5"/>
                <text x="125" y="200" font-family="Arial" font-size="14" font-weight="bold" fill="#388e3c" text-anchor="middle">ActivityThread</text>
                <text x="125" y="218" font-family="Arial" font-size="12" fill="#666" text-anchor="middle">Main Thread</text>
                
                <rect x="220" y="180" width="120" height="60" fill="white" stroke="#4caf50" stroke-width="2" rx="5"/>
                <text x="280" y="200" font-family="Arial" font-size="14" font-weight="bold" fill="#388e3c" text-anchor="middle">Application</text>
                <text x="280" y="218" font-family="Arial" font-size="12" fill="#666" text-anchor="middle">Your Code</text>
                
                <rect x="360" y="180" width="120" height="60" fill="white" stroke="#4caf50" stroke-width="2" rx="5"/>
                <text x="420" y="200" font-family="Arial" font-size="14" font-weight="bold" fill="#388e3c" text-anchor="middle">Activities</text>
                <text x="420" y="218" font-family="Arial" font-size="12" fill="#666" text-anchor="middle">UI Components</text>
                
                <rect x="100" y="320" width="150" height="40" fill="white" stroke="#2196f3" stroke-width="2" rx="5"/>
                <text x="175" y="343" font-family="Arial" font-size="14" fill="#1976d2" text-anchor="middle">Camera HAL</text>
                
                <rect x="280" y="320" width="150" height="40" fill="white" stroke="#2196f3" stroke-width="2" rx="5"/>
                <text x="355" y="343" font-family="Arial" font-size="14" fill="#1976d2" text-anchor="middle">Audio HAL</text>
                
                <rect x="460" y="320" width="150" height="40" fill="white" stroke="#2196f3" stroke-width="2" rx="5"/>
                <text x="535" y="343" font-family="Arial" font-size="14" fill="#1976d2" text-anchor="middle">Graphics HAL</text>
                
                <rect x="100" y="440" width="120" height="30" fill="white" stroke="#9c27b0" stroke-width="2" rx="5"/>
                <text x="160" y="458" font-family="Arial" font-size="12" fill="#7b1fa2" text-anchor="middle">Device Drivers</text>
                
                <rect x="250" y="440" width="120" height="30" fill="white" stroke="#9c27b0" stroke-width="2" rx="5"/>
                <text x="310" y="458" font-family="Arial" font-size="12" fill="#7b1fa2" text-anchor="middle">Memory Mgmt</text>
                
                <rect x="400" y="440" width="120" height="30" fill="white" stroke="#9c27b0" stroke-width="2" rx="5"/>
                <text x="460" y="458" font-family="Arial" font-size="12" fill="#7b1fa2" text-anchor="middle">Process Mgmt</text>
                
                <!-- Communication arrows -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
                    </marker>
                </defs>
                
                <!-- AMS to ActivityThread -->
                <line x1="150" y1="100" x2="125" y2="180" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="130" y="140" font-family="Arial" font-size="10" fill="#666">Binder IPC</text>
                
                <!-- ActivityThread to Activities -->
                <line x1="200" y1="210" x2="360" y2="210" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="270" y="205" font-family="Arial" font-size="10" fill="#666">Callbacks</text>
                
                <!-- HAL to Kernel -->
                <line x1="175" y1="360" x2="160" y2="440" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                <line x1="355" y1="360" x2="310" y2="440" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                <line x1="535" y1="360" x2="460" y2="440" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
            </svg>
        </div>
    </div>

    <div class="section">
        <h2>Hardware Driver Architecture</h2>
        
        <div class="important">
            <strong>Key Insight:</strong> Hardware vendors avoid kernel drivers due to GPL licensing requirements that force them to open-source their code. Instead, they use minimal kernel drivers with proprietary userspace HAL implementations.
        </div>
        
        <div class="svg-container">
            <svg width="700" height="400" viewBox="0 0 700 400" xmlns="http://www.w3.org/2000/svg">
                <!-- Userspace section -->
                <rect x="0" y="0" width="700" height="180" fill="#e8f5e8" stroke="#4caf50" stroke-width="2"/>
                <text x="20" y="25" font-family="Arial" font-size="16" font-weight="bold" fill="#388e3c">Userspace (No GPL Requirements)</text>
                
                <!-- Kernel space section -->
                <rect x="0" y="200" width="700" height="180" fill="#ffebee" stroke="#f44336" stroke-width="2"/>
                <text x="20" y="225" font-family="Arial" font-size="16" font-weight="bold" fill="#d32f2f">Kernel Space (GPL Required)</text>
                
                <!-- Android Framework -->
                <rect x="50" y="40" width="120" height="50" fill="white" stroke="#2196f3" stroke-width="2" rx="5"/>
                <text x="110" y="58" font-family="Arial" font-size="12" font-weight="bold" fill="#1976d2" text-anchor="middle">Android</text>
                <text x="110" y="75" font-family="Arial" font-size="12" fill="#666" text-anchor="middle">Framework</text>
                
                <!-- HAL Components -->
                <rect x="200" y="40" width="100" height="50" fill="white" stroke="#ff9800" stroke-width="2" rx="5"/>
                <text x="250" y="58" font-family="Arial" font-size="12" font-weight="bold" fill="#f57c00" text-anchor="middle">Camera HAL</text>
                <text x="250" y="75" font-family="Arial" font-size="10" fill="#666" text-anchor="middle">Proprietary</text>
                
                <rect x="320" y="40" width="100" height="50" fill="white" stroke="#ff9800" stroke-width="2" rx="5"/>
                <text x="370" y="58" font-family="Arial" font-size="12" font-weight="bold" fill="#f57c00" text-anchor="middle">GPU HAL</text>
                <text x="370" y="75" font-family="Arial" font-size="10" fill="#666" text-anchor="middle">Proprietary</text>
                
                <rect x="440" y="40" width="100" height="50" fill="white" stroke="#ff9800" stroke-width="2" rx="5"/>
                <text x="490" y="58" font-family="Arial" font-size="12" font-weight="bold" fill="#f57c00" text-anchor="middle">Audio HAL</text>
                <text x="490" y="75" font-family="Arial" font-size="10" fill="#666" text-anchor="middle">Proprietary</text>
                
                <!-- User/Kernel boundary -->
                <line x1="0" y1="180" x2="700" y2="180" stroke="#333" stroke-width="3" stroke-dasharray="5,5"/>
                <text x="350" y="195" font-family="Arial" font-size="14" font-weight="bold" fill="#333" text-anchor="middle">User/Kernel Boundary</text>
                
                <!-- Minimal kernel drivers -->
                <rect x="200" y="240" width="100" height="40" fill="white" stroke="#f44336" stroke-width="2" rx="5"/>
                <text x="250" y="253" font-family="Arial" font-size="11" font-weight="bold" fill="#d32f2f" text-anchor="middle">Minimal</text>
                <text x="250" y="268" font-family="Arial" font-size="11" fill="#666" text-anchor="middle">Camera Driver</text>
                
                <rect x="320" y="240" width="100" height="40" fill="white" stroke="#f44336" stroke-width="2" rx="5"/>
                <text x="370" y="253" font-family="Arial" font-size="11" font-weight="bold" fill="#d32f2f" text-anchor="middle">Minimal</text>
                <text x="370" y="268" font-family="Arial" font-size="11" fill="#666" text-anchor="middle">GPU Driver</text>
                
                <rect x="440" y="240" width="100" height="40" fill="white" stroke="#f44336" stroke-width="2" rx="5"/>
                <text x="490" y="253" font-family="Arial" font-size="11" font-weight="bold" fill="#d32f2f" text-anchor="middle">Minimal</text>
                <text x="490" y="268" font-family="Arial" font-size="11" fill="#666" text-anchor="middle">Audio Driver</text>
                
                <!-- Hardware -->
                <rect x="50" y="320" width="120" height="40" fill="#e0e0e0" stroke="#666" stroke-width="2" rx="5"/>
                <text x="110" y="343" font-family="Arial" font-size="12" fill="#333" text-anchor="middle">Hardware Registers</text>
                
                <rect x="200" y="320" width="100" height="40" fill="#e0e0e0" stroke="#666" stroke-width="2" rx="5"/>
                <text x="250" y="343" font-family="Arial" font-size="12" fill="#333" text-anchor="middle">Camera HW</text>
                
                <rect x="320" y="320" width="100" height="40" fill="#e0e0e0" stroke="#666" stroke-width="2" rx="5"/>
                <text x="370" y="343" font-family="Arial" font-size="12" fill="#333" text-anchor="middle">GPU HW</text>
                
                <rect x="440" y="320" width="100" height="40" fill="#e0e0e0" stroke="#666" stroke-width="2" rx="5"/>
                <text x="490" y="343" font-family="Arial" font-size="12" fill="#333" text-anchor="middle">Audio HW</text>
                
                <!-- Arrows -->
                <defs>
                    <marker id="arrow" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
                    </marker>
                </defs>
                
                <!-- HAL to kernel drivers -->
                <line x1="250" y1="90" x2="250" y2="240" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                <line x1="370" y1="90" x2="370" y2="240" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                <line x1="490" y1="90" x2="490" y2="240" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                
                <!-- Kernel to hardware -->
                <line x1="250" y1="280" x2="250" y2="320" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                <line x1="370" y1="280" x2="370" y2="320" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                <line x1="490" y1="280" x2="490" y2="320" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                
                <!-- Labels -->
                <text x="260" y="115" font-family="Arial" font-size="10" fill="#666">ioctl/mmap</text>
                <text x="260" y="300" font-family="Arial" font-size="10" fill="#666">Hardware Access</text>
            </svg>
        </div>
    </div>

    <div class="section">
        <h2>Component Responsibilities</h2>
        
        <div class="component-grid">
            <div class="component-card system">
                <div class="component-title">ActivityManagerService (AMS)</div>
                <ul>
                    <li><strong>Process:</strong> System Server</li>
                    <li><strong>Role:</strong> Global lifecycle coordinator</li>
                    <li>Intent resolution and routing</li>
                    <li>Process creation and management</li>
                    <li>Activity stack management</li>
                    <li>Resource allocation decisions</li>
                    <li>Security policy enforcement</li>
                </ul>
            </div>
            
            <div class="component-card app">
                <div class="component-title">ActivityThread</div>
                <ul>
                    <li><strong>Process:</strong> Application Process</li>
                    <li><strong>Role:</strong> IPC bridge and orchestrator</li>
                    <li>Main thread message loop</li>
                    <li>Binder IPC communication handler</li>
                    <li>Lifecycle callback coordination</li>
                    <li>Application context management</li>
                    <li>Configuration change handling</li>
                </ul>
            </div>
            
            <div class="component-card userspace">
                <div class="component-title">Your Application</div>
                <ul>
                    <li><strong>Process:</strong> Application Process</li>
                    <li><strong>Role:</strong> Business logic implementation</li>
                    <li>Activity lifecycle callbacks</li>
                    <li>UI rendering and user interaction</li>
                    <li>Data processing and storage</li>
                    <li>Network communication</li>
                    <li>Service and broadcast receivers</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Activity Lifecycle Flow</h2>
        
        <div class="svg-container">
            <svg width="600" height="400" viewBox="0 0 600 400" xmlns="http://www.w3.org/2000/svg">
                <!-- Background -->
                <rect x="0" y="0" width="600" height="400" fill="#fafafa"/>
                
                <!-- Lifecycle states -->
                <circle cx="100" cy="60" r="30" fill="#4caf50" stroke="#388e3c" stroke-width="2"/>
                <text x="100" y="65" font-family="Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">Created</text>
                
                <circle cx="300" cy="60" r="30" fill="#2196f3" stroke="#1976d2" stroke-width="2"/>
                <text x="300" y="65" font-family="Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">Started</text>
                
                <circle cx="500" cy="60" r="30" fill="#ff9800" stroke="#f57c00" stroke-width="2"/>
                <text x="500" y="65" font-family="Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">Resumed</text>
                
                <circle cx="500" cy="180" r="30" fill="#9e9e9e" stroke="#616161" stroke-width="2"/>
                <text x="500" y="185" font-family="Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">Paused</text>
                
                <circle cx="300" cy="180" r="30" fill="#795548" stroke="#5d4037" stroke-width="2"/>
                <text x="300" y="185" font-family="Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">Stopped</text>
                
                <circle cx="100" cy="180" r="30" fill="#f44336" stroke="#d32f2f" stroke-width="2"/>
                <text x="100" y="185" font-family="Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">Destroyed</text>
                
                <!-- Arrows and labels -->
                <defs>
                    <marker id="lifecycleArrow" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
                    </marker>
                </defs>
                
                <!-- onCreate -->
                <line x1="130" y1="60" x2="270" y2="60" stroke="#333" stroke-width="2" marker-end="url(#lifecycleArrow)"/>
                <text x="200" y="45" font-family="Arial" font-size="11" fill="#333" text-anchor="middle">onCreate()</text>
                
                <!-- onStart -->
                <line x1="330" y1="60" x2="470" y2="60" stroke="#333" stroke-width="2" marker-end="url(#lifecycleArrow)"/>
                <text x="400" y="45" font-family="Arial" font-size="11" fill="#333" text-anchor="middle">onResume()</text>
                
                <!-- onPause -->
                <line x1="500" y1="90" x2="500" y2="150" stroke="#333" stroke-width="2" marker-end="url(#lifecycleArrow)"/>
                <text x="515" y="120" font-family="Arial" font-size="11" fill="#333">onPause()</text>
                
                <!-- onStop -->
                <line x1="470" y1="180" x2="330" y2="180" stroke="#333" stroke-width="2" marker-end="url(#lifecycleArrow)"/>
                <text x="400" y="195" font-family="Arial" font-size="11" fill="#333" text-anchor="middle">onStop()</text>
                
                <!-- onDestroy -->
                <line x1="270" y1="180" x2="130" y2="180" stroke="#333" stroke-width="2" marker-end="url(#lifecycleArrow)"/>
                <text x="200" y="195" font-family="Arial" font-size="11" fill="#333" text-anchor="middle">onDestroy()</text>
                
                <!-- Back arrows -->
                <path d="M 500 210 Q 400 250 300 210" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#lifecycleArrow)"/>
                <text x="400" y="240" font-family="Arial" font-size="10" fill="#666" text-anchor="middle">onRestart()</text>
                
                <path d="M 300 90 Q 400 130 500 90" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#lifecycleArrow)"/>
                <text x="400" y="115" font-family="Arial" font-size="10" fill="#666" text-anchor="middle">onStart()</text>
                
                <!-- System coordination label -->
                <text x="300" y="320" font-family="Arial" font-size="14" font-weight="bold" fill="#1976d2" text-anchor="middle">
                    AMS → ActivityThread → Your Activity
                </text>
                <text x="300" y="340" font-family="Arial" font-size="12" fill="#666" text-anchor="middle">
                    All lifecycle transitions coordinated by system
                </text>
            </svg>
        </div>
        
        <div class="highlight-box">
            <strong>Key Point:</strong> Every lifecycle callback in your Activity is triggered by AMS decisions and delivered through ActivityThread's message handling system.
        </div>
    </div>

    <div class="section">
        <h2>Communication Patterns</h2>
        
        <div class="architecture-diagram">
            <h3>IPC Communication Flow</h3>
            
            <div class="flow-step">
                <span class="step-number">1</span>
                <strong>Intent Trigger:</strong> User action or system event triggers an intent (e.g., app launch, activity switch)
            </div>
            
            <div class="flow-step">
                <span class="step-number">2</span>
                <strong>AMS Processing:</strong> ActivityManagerService resolves intent, checks permissions, makes lifecycle decisions
            </div>
            
            <div class="flow-step">
                <span class="step-number">3</span>
                <strong>Binder IPC:</strong> AMS sends transaction to ApplicationThread via Binder (cross-process communication)
            </div>
            
            <div class="flow-step">
                <span class="step-number">4</span>
                <strong>Message Queue:</strong> ActivityThread receives Binder call, posts message to main thread Handler
            </div>
            
            <div class="flow-step">
                <span class="step-number">5</span>
                <strong>Callback Execution:</strong> ActivityThread calls appropriate lifecycle method on your Activity
            </div>
            
            <div class="flow-step">
                <span class="step-number">6</span>
                <strong>Business Logic:</strong> Your Activity code executes, updates UI, processes data
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Hardware Driver Licensing Problem</h2>
        
        <div class="important">
            <strong>GPL Licensing Challenge:</strong> Linux kernel requires GPL licensing for drivers, forcing vendors to open-source their code. This conflicts with proprietary business models and trade secrets.
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>Component</th>
                    <th>Location</th>
                    <th>License Requirement</th>
                    <th>Vendor Strategy</th>
                    <th>Functionality</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Kernel Driver</strong></td>
                    <td>Kernel Space</td>
                    <td>GPL (Open Source)</td>
                    <td>Minimal implementation</td>
                    <td>Basic hardware access, memory mapping, interrupts</td>
                </tr>
                <tr>
                    <td><strong>HAL Library</strong></td>
                    <td>Userspace</td>
                    <td>No GPL requirement</td>
                    <td>Proprietary implementation</td>
                    <td>Complex algorithms, optimization, features</td>
                </tr>
                <tr>
                    <td><strong>Android Framework</strong></td>
                    <td>Userspace</td>
                    <td>Apache 2.0</td>
                    <td>Standard interface</td>
                    <td>API abstraction for apps</td>
                </tr>
            </tbody>
        </table>
        
        <h3>Why Kernel Access is Required</h3>
        <ul>
            <li><strong>Hardware Privileges:</strong> Direct hardware register access requires kernel-level privileges</li>
            <li><strong>Interrupt Handling:</strong> Hardware interrupts can only be handled in kernel space</li>
            <li><strong>Memory Management:</strong> DMA and physical memory allocation requires kernel APIs</li>
            <li><strong>Device Files:</strong> Creating /dev entries requires kernel driver support</li>
            <li><strong>Resource Allocation:</strong> IRQ lines, GPIO pins, memory ranges must be reserved by kernel</li>
        </ul>
    </div>

    <div class="section">
        <h2>Practical Examples</h2>
        
        <h3>Activity Launch Code Example</h3>
        <div class="code-block">
            <pre><code class="language-java">public class MainActivity extends Activity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        
        // This callback triggered by:
        // AMS → ApplicationThread (Binder) → ActivityThread → onCreate()
        Log.d("Lifecycle", "onCreate: AMS coordinated activity creation");
        
        // Initialize UI components
        setupUserInterface();
        loadInitialData();
    }
    
    @Override
    protected void onResume() {
        super.onResume();
        
        // AMS determined this activity should be in foreground
        Log.d("Lifecycle", "onResume: Ready for user interaction");
        
        // Start foreground operations
        startLocationUpdates();
        resumeAnimations();
    }
    
    @Override
    protected void onPause() {
        super.onPause();
        
        // AMS signaling activity losing focus (another app, notification, etc.)
        Log.d("Lifecycle", "onPause: Save critical state immediately");
        
        // Must complete quickly to avoid ANR
        saveCriticalUserData();
        pauseExpensiveOperations();
    }
}</code></pre>
        </div>
        
        <h3>HAL Implementation Pattern</h3>
        <div class="code-block">
            <pre><code class="language-c">// Minimal kernel driver (GPL required)
// camera_driver.c - Must be open source
static long camera_ioctl(struct file *file, unsigned int cmd, unsigned long arg) {
    switch (cmd) {
        case CAMERA_START:
            // Basic hardware initialization
            writel(CAMERA_ENABLE, camera_base + CAMERA_CTRL_REG);
            return 0;
        case CAMERA_GET_BUFFER:
            // Map DMA buffer to userspace
            return camera_map_buffer(arg);
        default:
            return -EINVAL;
    }
}

// Userspace HAL implementation (proprietary allowed)
// camera_hal.so - Can be closed source
class CameraHAL {
    int openCamera(int cameraId) {
        // Open kernel driver
        fd = open("/dev/camera0", O_RDWR);
        
        // Proprietary initialization algorithms
        initializeProprietaryISP();
        loadVendorCalibrationData();
        setupAdvancedFeatures();
        
        return 0;
    }
    
    void captureImage() {
        // Complex image processing (trade secrets)
        applyProprietaryNoiseReduction();
        performAdvancedHDR();
        optimizeForVendorSensor();
    }
};</code></pre>
        </div>
    </div>

    <div class="section">
        <h2>Best Practices Summary</h2>
        
        <div class="component-grid">
            <div class="component-card system">
                <div class="component-title">System Integration</div>
                <ul>
                    <li>Trust AMS for lifecycle decisions</li>
                    <li>Handle configuration changes gracefully</li>
                    <li>Respond quickly to system callbacks</li>
                    <li>Save state in onPause(), not onDestroy()</li>
                    <li>Use proper intent flags and launch modes</li>
                </ul>
            </div>
            
            <div class="component-card app">
                <div class="component-title">Threading & Performance</div>
                <ul>
                    <li>Keep main thread free for UI updates</li>
                    <li>Use background threads for heavy operations</li>
                    <li>Avoid blocking operations in lifecycle callbacks</li>
                    <li>Handle ANRs proactively</li>
                    <li>Use WeakReferences to prevent memory leaks</li>
                </ul>
            </div>
            
            <div class="component-card userspace">
                <div class="component-title">Hardware Integration</div>
                <ul>
                    <li>Use HAL APIs instead of direct kernel access</li>
                    <li>Handle hardware permissions properly</li>
                    <li>Respect device capabilities and limitations</li>
                    <li>Implement proper error handling</li>
                    <li>Consider vendor-specific behavior</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Debugging and Monitoring</h2>
        
        <div class="highlight-box">
            <strong>Development Tips:</strong> Use these ADB commands to monitor the system components in action
        </div>
        
        <div class="code-block">
            <pre><code class="language-bash"># Monitor ActivityManagerService decisions
adb shell dumpsys activity activities

# Watch ActivityThread message processing
adb logcat -s ActivityThread

# Check hardware driver status
adb shell lsmod | grep camera
adb shell ls -la /dev/camera*

# Monitor system server (where AMS runs)
adb shell dumpsys activity service
adb shell top | grep system_server

# Check HAL library loading
adb shell lsof | grep "\.so"
adb logcat -s HAL</code></pre>
        </div>
    </div>

    <div class="section">
        <h2>Architecture Insights</h2>
        
        <div class="important">
            <strong>Key Architectural Decisions:</strong> Understanding why Android is designed this way helps you work with the system instead of against it.
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>Design Decision</th>
                    <th>Reasoning</th>
                    <th>Developer Impact</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Centralized AMS</strong></td>
                    <td>Single source of truth for lifecycle, security, resource management</td>
                    <td>Apps don't control their own lifecycle - respond to system events</td>
                </tr>
                <tr>
                    <td><strong>Binder IPC</strong></td>
                    <td>Secure cross-process communication with reference counting</td>
                    <td>Async communication patterns, handle process death gracefully</td>
                </tr>
                <tr>
                    <td><strong>ActivityThread Bridge</strong></td>
                    <td>Isolate app code from system complexity, provide consistent threading</td>
                    <td>All UI work happens on main thread, use callbacks not polling</td>
                </tr>
                <tr>
                    <td><strong>HAL Abstraction</strong></td>
                    <td>Enable proprietary drivers while maintaining standard APIs</td>
                    <td>Use framework APIs, don't access hardware directly</td>
                </tr>
                <tr>
                    <td><strong>Process Isolation</strong></td>
                    <td>Security, stability, resource management</td>
                    <td>Assume process can be killed anytime, save state frequently</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2>Summary</h2>
        
        <div class="objective">
            <strong>Core Concepts:</strong> Android's architecture balances security, performance, and flexibility through careful separation of concerns between system services, application processes, and hardware abstraction layers.
        </div>
        
        <ul>
            <li><strong>ActivityManagerService</strong> is the central coordinator running in system server, making all high-level lifecycle decisions</li>
            <li><strong>ActivityThread</strong> acts as the bridge between system services and your app, handling IPC and coordinating callbacks on the main thread</li>
            <li><strong>Your Application</strong> responds to system events through lifecycle callbacks, focusing on business logic and user experience</li>
            <li><strong>Hardware drivers</strong> split between minimal GPL kernel components and proprietary userspace HAL libraries to avoid licensing issues</li>
            <li><strong>Communication flows</strong> through well-defined interfaces: Binder IPC between processes, Handler messages within processes, and standard syscalls to kernel</li>
        </ul>
        
        <p>Understanding these relationships helps you build more robust Android applications that work harmoniously with the system rather than fighting against its design principles.</p>
    </div>
</body>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        hljs.highlightAll();
        
        // Add smooth scrolling for internal links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    });
</script>

</html>